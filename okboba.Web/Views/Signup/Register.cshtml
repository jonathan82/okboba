@model okboba.Web.Models.RegisterViewModel

@{
    ViewBag.Title = "OkBoba - The Premier Dating Site for Smart Singles";
}

@using (Html.BeginForm("Register", "Account", FormMethod.Post, new { id = "registerForm" }))
{
    @Html.Partial("_RegisterStep1")
    
    @Html.Partial("_RegisterStep2")
}

@Html.Partial("_LocationPicker")

@section Scripts {

    <script>
        window.history.pushState({step: 'step1'},"step1",null);

        //Next button
        $('#NextButton').click(function (e) {
            e.preventDefault();

            $('#register-step-1').fadeOut('fast', function (e) {
                $('#register-step-2').fadeIn('fast');
            });            

            window.history.pushState({step: 'step2'},null,null);
        });

        //Back button
        $(window).on('popstate', function (e) {
            //alert('popstate ' + e.originalEvent.state.step);
            if (e.originalEvent.state.step == 'step1') {
                $('#register-step-2').fadeOut('fast', function (e) {
                    $('#register-step-1').fadeIn('fast');
                });
            } else if(e.originalEvent.state.step == 'step2') {
                $('#register-step-1').fadeOut('fast', function (e) {
                    $('#register-step-2').fadeIn('fast');
                });
            }
        });

        //Setup the birthdate picker
        $("#Birthdate").datepicker( {
            format: "yyyy年mm月",
            startView: 2, 
            minViewMode: "months",
            language: "zh-CN",
            orientation: "bottom auto",
            defaultViewDate: {year: 1980},
            autoclose: true
        });

        //Setup the location picker
        var provinces = @Html.Raw(ViewBag.JsonProvinces);
        $('#locationinput').locationpicker(provinces);

        //Validation
        $('#registerForm').validate();

        //Submit button
        $('form').submit(function (e) {
            e.preventDefault();
            //set the date
            var re = /(\d\d\d\d)年(\d\d)月/;

        });
    </script>
}
